<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Source of the Rust file `src/space_traders_client.rs`."><meta name="keywords" content="rust, rustlang, rust-lang"><title>space_traders_client.rs - source</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" href="../../normalize.css"><link rel="stylesheet" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" href="../../ayu.css" disabled><link rel="stylesheet" href="../../dark.css" disabled><link rel="stylesheet" href="../../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../../storage.js"></script><script defer src="../../source-script.js"></script><script defer src="../../source-files.js"></script><script defer src="../../main.js"></script><noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../favicon.svg"></head><body class="rustdoc source"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../../space_traders/index.html"><div class="logo-container"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></div></a><h2 class="location"></h2></nav><nav class="sidebar"><a class="sidebar-logo" href="../../space_traders/index.html"><div class="logo-container"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></div></a></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../../space_traders/index.html"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></a><nav class="sub"><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><button type="button">?</button></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../wheel.svg"></a></div></div></form></nav></div><section id="main-content" class="content"><div class="example-wrap"><pre class="line-numbers"><span id="1">1</span>
<span id="2">2</span>
<span id="3">3</span>
<span id="4">4</span>
<span id="5">5</span>
<span id="6">6</span>
<span id="7">7</span>
<span id="8">8</span>
<span id="9">9</span>
<span id="10">10</span>
<span id="11">11</span>
<span id="12">12</span>
<span id="13">13</span>
<span id="14">14</span>
<span id="15">15</span>
<span id="16">16</span>
<span id="17">17</span>
<span id="18">18</span>
<span id="19">19</span>
<span id="20">20</span>
<span id="21">21</span>
<span id="22">22</span>
<span id="23">23</span>
<span id="24">24</span>
<span id="25">25</span>
<span id="26">26</span>
<span id="27">27</span>
<span id="28">28</span>
<span id="29">29</span>
<span id="30">30</span>
<span id="31">31</span>
<span id="32">32</span>
<span id="33">33</span>
<span id="34">34</span>
<span id="35">35</span>
<span id="36">36</span>
<span id="37">37</span>
<span id="38">38</span>
<span id="39">39</span>
<span id="40">40</span>
<span id="41">41</span>
<span id="42">42</span>
<span id="43">43</span>
<span id="44">44</span>
<span id="45">45</span>
<span id="46">46</span>
<span id="47">47</span>
<span id="48">48</span>
<span id="49">49</span>
<span id="50">50</span>
<span id="51">51</span>
<span id="52">52</span>
<span id="53">53</span>
<span id="54">54</span>
<span id="55">55</span>
<span id="56">56</span>
<span id="57">57</span>
<span id="58">58</span>
<span id="59">59</span>
<span id="60">60</span>
<span id="61">61</span>
<span id="62">62</span>
<span id="63">63</span>
<span id="64">64</span>
<span id="65">65</span>
<span id="66">66</span>
<span id="67">67</span>
<span id="68">68</span>
<span id="69">69</span>
<span id="70">70</span>
<span id="71">71</span>
<span id="72">72</span>
<span id="73">73</span>
<span id="74">74</span>
<span id="75">75</span>
<span id="76">76</span>
<span id="77">77</span>
<span id="78">78</span>
<span id="79">79</span>
<span id="80">80</span>
<span id="81">81</span>
<span id="82">82</span>
<span id="83">83</span>
<span id="84">84</span>
<span id="85">85</span>
<span id="86">86</span>
<span id="87">87</span>
<span id="88">88</span>
<span id="89">89</span>
<span id="90">90</span>
<span id="91">91</span>
<span id="92">92</span>
<span id="93">93</span>
<span id="94">94</span>
<span id="95">95</span>
<span id="96">96</span>
<span id="97">97</span>
<span id="98">98</span>
<span id="99">99</span>
<span id="100">100</span>
<span id="101">101</span>
<span id="102">102</span>
<span id="103">103</span>
<span id="104">104</span>
<span id="105">105</span>
<span id="106">106</span>
<span id="107">107</span>
<span id="108">108</span>
<span id="109">109</span>
<span id="110">110</span>
<span id="111">111</span>
<span id="112">112</span>
<span id="113">113</span>
<span id="114">114</span>
<span id="115">115</span>
<span id="116">116</span>
<span id="117">117</span>
<span id="118">118</span>
<span id="119">119</span>
<span id="120">120</span>
<span id="121">121</span>
<span id="122">122</span>
<span id="123">123</span>
<span id="124">124</span>
<span id="125">125</span>
<span id="126">126</span>
<span id="127">127</span>
<span id="128">128</span>
<span id="129">129</span>
<span id="130">130</span>
<span id="131">131</span>
<span id="132">132</span>
<span id="133">133</span>
<span id="134">134</span>
<span id="135">135</span>
<span id="136">136</span>
<span id="137">137</span>
<span id="138">138</span>
<span id="139">139</span>
<span id="140">140</span>
<span id="141">141</span>
<span id="142">142</span>
<span id="143">143</span>
<span id="144">144</span>
<span id="145">145</span>
<span id="146">146</span>
<span id="147">147</span>
<span id="148">148</span>
<span id="149">149</span>
<span id="150">150</span>
<span id="151">151</span>
<span id="152">152</span>
<span id="153">153</span>
<span id="154">154</span>
<span id="155">155</span>
<span id="156">156</span>
<span id="157">157</span>
<span id="158">158</span>
<span id="159">159</span>
<span id="160">160</span>
<span id="161">161</span>
<span id="162">162</span>
<span id="163">163</span>
<span id="164">164</span>
<span id="165">165</span>
<span id="166">166</span>
<span id="167">167</span>
<span id="168">168</span>
<span id="169">169</span>
<span id="170">170</span>
<span id="171">171</span>
<span id="172">172</span>
<span id="173">173</span>
<span id="174">174</span>
<span id="175">175</span>
<span id="176">176</span>
<span id="177">177</span>
<span id="178">178</span>
<span id="179">179</span>
<span id="180">180</span>
<span id="181">181</span>
<span id="182">182</span>
<span id="183">183</span>
<span id="184">184</span>
<span id="185">185</span>
<span id="186">186</span>
<span id="187">187</span>
<span id="188">188</span>
<span id="189">189</span>
<span id="190">190</span>
<span id="191">191</span>
<span id="192">192</span>
<span id="193">193</span>
<span id="194">194</span>
<span id="195">195</span>
<span id="196">196</span>
<span id="197">197</span>
<span id="198">198</span>
<span id="199">199</span>
<span id="200">200</span>
<span id="201">201</span>
<span id="202">202</span>
<span id="203">203</span>
<span id="204">204</span>
<span id="205">205</span>
<span id="206">206</span>
<span id="207">207</span>
<span id="208">208</span>
<span id="209">209</span>
<span id="210">210</span>
<span id="211">211</span>
<span id="212">212</span>
<span id="213">213</span>
<span id="214">214</span>
<span id="215">215</span>
<span id="216">216</span>
<span id="217">217</span>
<span id="218">218</span>
<span id="219">219</span>
<span id="220">220</span>
<span id="221">221</span>
<span id="222">222</span>
<span id="223">223</span>
<span id="224">224</span>
<span id="225">225</span>
<span id="226">226</span>
<span id="227">227</span>
<span id="228">228</span>
<span id="229">229</span>
<span id="230">230</span>
<span id="231">231</span>
<span id="232">232</span>
<span id="233">233</span>
<span id="234">234</span>
<span id="235">235</span>
<span id="236">236</span>
<span id="237">237</span>
<span id="238">238</span>
<span id="239">239</span>
<span id="240">240</span>
<span id="241">241</span>
<span id="242">242</span>
<span id="243">243</span>
<span id="244">244</span>
<span id="245">245</span>
<span id="246">246</span>
<span id="247">247</span>
<span id="248">248</span>
<span id="249">249</span>
<span id="250">250</span>
<span id="251">251</span>
<span id="252">252</span>
<span id="253">253</span>
<span id="254">254</span>
<span id="255">255</span>
<span id="256">256</span>
<span id="257">257</span>
<span id="258">258</span>
<span id="259">259</span>
<span id="260">260</span>
<span id="261">261</span>
<span id="262">262</span>
<span id="263">263</span>
<span id="264">264</span>
<span id="265">265</span>
<span id="266">266</span>
<span id="267">267</span>
<span id="268">268</span>
<span id="269">269</span>
<span id="270">270</span>
<span id="271">271</span>
<span id="272">272</span>
<span id="273">273</span>
<span id="274">274</span>
<span id="275">275</span>
<span id="276">276</span>
<span id="277">277</span>
<span id="278">278</span>
<span id="279">279</span>
<span id="280">280</span>
<span id="281">281</span>
<span id="282">282</span>
<span id="283">283</span>
<span id="284">284</span>
<span id="285">285</span>
<span id="286">286</span>
<span id="287">287</span>
<span id="288">288</span>
<span id="289">289</span>
<span id="290">290</span>
<span id="291">291</span>
<span id="292">292</span>
<span id="293">293</span>
<span id="294">294</span>
<span id="295">295</span>
<span id="296">296</span>
<span id="297">297</span>
<span id="298">298</span>
<span id="299">299</span>
<span id="300">300</span>
<span id="301">301</span>
<span id="302">302</span>
<span id="303">303</span>
<span id="304">304</span>
<span id="305">305</span>
<span id="306">306</span>
<span id="307">307</span>
<span id="308">308</span>
<span id="309">309</span>
<span id="310">310</span>
<span id="311">311</span>
<span id="312">312</span>
<span id="313">313</span>
<span id="314">314</span>
<span id="315">315</span>
<span id="316">316</span>
<span id="317">317</span>
<span id="318">318</span>
<span id="319">319</span>
<span id="320">320</span>
<span id="321">321</span>
<span id="322">322</span>
<span id="323">323</span>
<span id="324">324</span>
<span id="325">325</span>
<span id="326">326</span>
<span id="327">327</span>
<span id="328">328</span>
<span id="329">329</span>
<span id="330">330</span>
<span id="331">331</span>
<span id="332">332</span>
<span id="333">333</span>
<span id="334">334</span>
<span id="335">335</span>
<span id="336">336</span>
<span id="337">337</span>
<span id="338">338</span>
<span id="339">339</span>
<span id="340">340</span>
<span id="341">341</span>
<span id="342">342</span>
<span id="343">343</span>
<span id="344">344</span>
<span id="345">345</span>
<span id="346">346</span>
<span id="347">347</span>
<span id="348">348</span>
<span id="349">349</span>
<span id="350">350</span>
<span id="351">351</span>
<span id="352">352</span>
<span id="353">353</span>
<span id="354">354</span>
<span id="355">355</span>
<span id="356">356</span>
<span id="357">357</span>
<span id="358">358</span>
<span id="359">359</span>
<span id="360">360</span>
<span id="361">361</span>
<span id="362">362</span>
<span id="363">363</span>
<span id="364">364</span>
<span id="365">365</span>
<span id="366">366</span>
<span id="367">367</span>
<span id="368">368</span>
<span id="369">369</span>
<span id="370">370</span>
<span id="371">371</span>
<span id="372">372</span>
<span id="373">373</span>
<span id="374">374</span>
<span id="375">375</span>
<span id="376">376</span>
<span id="377">377</span>
<span id="378">378</span>
<span id="379">379</span>
<span id="380">380</span>
<span id="381">381</span>
<span id="382">382</span>
<span id="383">383</span>
<span id="384">384</span>
<span id="385">385</span>
<span id="386">386</span>
<span id="387">387</span>
<span id="388">388</span>
<span id="389">389</span>
<span id="390">390</span>
<span id="391">391</span>
<span id="392">392</span>
<span id="393">393</span>
<span id="394">394</span>
<span id="395">395</span>
<span id="396">396</span>
<span id="397">397</span>
<span id="398">398</span>
<span id="399">399</span>
<span id="400">400</span>
<span id="401">401</span>
<span id="402">402</span>
<span id="403">403</span>
<span id="404">404</span>
<span id="405">405</span>
<span id="406">406</span>
<span id="407">407</span>
<span id="408">408</span>
<span id="409">409</span>
<span id="410">410</span>
<span id="411">411</span>
<span id="412">412</span>
<span id="413">413</span>
<span id="414">414</span>
<span id="415">415</span>
<span id="416">416</span>
<span id="417">417</span>
<span id="418">418</span>
<span id="419">419</span>
<span id="420">420</span>
<span id="421">421</span>
<span id="422">422</span>
<span id="423">423</span>
<span id="424">424</span>
<span id="425">425</span>
<span id="426">426</span>
<span id="427">427</span>
<span id="428">428</span>
<span id="429">429</span>
<span id="430">430</span>
<span id="431">431</span>
<span id="432">432</span>
<span id="433">433</span>
<span id="434">434</span>
<span id="435">435</span>
<span id="436">436</span>
<span id="437">437</span>
<span id="438">438</span>
<span id="439">439</span>
<span id="440">440</span>
<span id="441">441</span>
<span id="442">442</span>
<span id="443">443</span>
<span id="444">444</span>
<span id="445">445</span>
<span id="446">446</span>
<span id="447">447</span>
<span id="448">448</span>
<span id="449">449</span>
<span id="450">450</span>
<span id="451">451</span>
<span id="452">452</span>
<span id="453">453</span>
<span id="454">454</span>
<span id="455">455</span>
<span id="456">456</span>
<span id="457">457</span>
<span id="458">458</span>
<span id="459">459</span>
<span id="460">460</span>
<span id="461">461</span>
<span id="462">462</span>
<span id="463">463</span>
<span id="464">464</span>
<span id="465">465</span>
<span id="466">466</span>
<span id="467">467</span>
<span id="468">468</span>
<span id="469">469</span>
<span id="470">470</span>
<span id="471">471</span>
<span id="472">472</span>
<span id="473">473</span>
<span id="474">474</span>
<span id="475">475</span>
<span id="476">476</span>
<span id="477">477</span>
<span id="478">478</span>
<span id="479">479</span>
<span id="480">480</span>
<span id="481">481</span>
<span id="482">482</span>
<span id="483">483</span>
<span id="484">484</span>
<span id="485">485</span>
<span id="486">486</span>
<span id="487">487</span>
<span id="488">488</span>
<span id="489">489</span>
<span id="490">490</span>
<span id="491">491</span>
<span id="492">492</span>
<span id="493">493</span>
<span id="494">494</span>
<span id="495">495</span>
<span id="496">496</span>
<span id="497">497</span>
<span id="498">498</span>
<span id="499">499</span>
<span id="500">500</span>
<span id="501">501</span>
<span id="502">502</span>
<span id="503">503</span>
<span id="504">504</span>
<span id="505">505</span>
<span id="506">506</span>
<span id="507">507</span>
<span id="508">508</span>
<span id="509">509</span>
<span id="510">510</span>
<span id="511">511</span>
<span id="512">512</span>
<span id="513">513</span>
<span id="514">514</span>
<span id="515">515</span>
<span id="516">516</span>
<span id="517">517</span>
<span id="518">518</span>
<span id="519">519</span>
<span id="520">520</span>
<span id="521">521</span>
<span id="522">522</span>
<span id="523">523</span>
<span id="524">524</span>
<span id="525">525</span>
<span id="526">526</span>
<span id="527">527</span>
<span id="528">528</span>
<span id="529">529</span>
<span id="530">530</span>
<span id="531">531</span>
<span id="532">532</span>
<span id="533">533</span>
<span id="534">534</span>
<span id="535">535</span>
<span id="536">536</span>
<span id="537">537</span>
<span id="538">538</span>
<span id="539">539</span>
<span id="540">540</span>
<span id="541">541</span>
<span id="542">542</span>
<span id="543">543</span>
<span id="544">544</span>
<span id="545">545</span>
<span id="546">546</span>
<span id="547">547</span>
<span id="548">548</span>
<span id="549">549</span>
<span id="550">550</span>
<span id="551">551</span>
<span id="552">552</span>
<span id="553">553</span>
<span id="554">554</span>
<span id="555">555</span>
<span id="556">556</span>
<span id="557">557</span>
<span id="558">558</span>
<span id="559">559</span>
<span id="560">560</span>
<span id="561">561</span>
<span id="562">562</span>
<span id="563">563</span>
<span id="564">564</span>
<span id="565">565</span>
<span id="566">566</span>
<span id="567">567</span>
<span id="568">568</span>
<span id="569">569</span>
<span id="570">570</span>
<span id="571">571</span>
<span id="572">572</span>
<span id="573">573</span>
<span id="574">574</span>
<span id="575">575</span>
<span id="576">576</span>
<span id="577">577</span>
<span id="578">578</span>
<span id="579">579</span>
<span id="580">580</span>
<span id="581">581</span>
<span id="582">582</span>
<span id="583">583</span>
<span id="584">584</span>
<span id="585">585</span>
<span id="586">586</span>
<span id="587">587</span>
<span id="588">588</span>
<span id="589">589</span>
<span id="590">590</span>
</pre><pre class="rust"><code><span class="doccomment">//! Provides the main functionality to interact with the `SpaceTraders API`.

</span><span class="kw">use crate</span>::{
    agent::Agent,
    conditional_types::Symbol,
    contract::Contract,
    faction::{Faction, FactionSymbol},
    ship::Ship,
    waypoint::Waypoint,
    ResponseData, STResult, SpaceTradersError,
};
<span class="kw">use </span>std::collections::HashMap;

<span class="doccomment">/// Values cached from initial registration
</span><span class="attribute">#[derive(Debug, serde::Serialize, serde::Deserialize)]
</span><span class="kw">struct </span>CachedInfo {
    agent: Agent,
    contracts: Vec&lt;Contract&gt;,
    faction: Faction,
    ship: Ship,
}

<span class="doccomment">/// The client used to interact with the `SpaceTraders API`.
</span><span class="attribute">#[derive(Debug)]
</span><span class="kw">pub struct </span>SpaceTradersClient {
    client: reqwest::Client,
    token: <span class="prelude-ty">Option</span>&lt;String&gt;,
    token_set: bool,
    cache: <span class="prelude-ty">Option</span>&lt;CachedInfo&gt;,
}

<span class="kw">impl </span>Default <span class="kw">for </span>SpaceTradersClient {
    <span class="doccomment">/// Initalize a client to register with.
    ///
    /// **NOTE: [register_callsign](Self::register_callsign) must be called to generate a token and get registration data.**
    </span><span class="kw">fn </span>default() -&gt; <span class="self">Self </span>{
        <span class="self">Self </span>{
            client: reqwest::Client::new(),
            token: <span class="prelude-val">None</span>,
            token_set: <span class="bool-val">false</span>,
            cache: <span class="prelude-val">None</span>,
        }
    }
}

<span class="kw">impl </span>SpaceTradersClient {
    <span class="comment">// TODO: Eventually add support for multiple save files
    //
    </span><span class="doccomment">/// Load a `SpaceTradersClient` from a save file.
    ///
    /// Currently, there can only be one save file (named `spacetraders.save`), though support for
    /// multiple save files will be added in the future.
    ///
    ///
    /// # Example
    /// ```
    /// # use space_traders::prelude::*;
    /// // Creates SpaceTradersClient from the data saved in the &quot;spacetraders.save&quot; file.
    /// let client = SpaceTradersClient::load_saved();
    /// ```
    </span><span class="kw">pub fn </span>load_saved() -&gt; STResult&lt;<span class="self">Self</span>&gt; {
        <span class="kw">use </span>std::fs::File;
        <span class="kw">use </span>std::io::BufRead;
        <span class="kw">use </span>std::io::BufReader;

        <span class="kw">const </span>SAVEFILE: <span class="kw-2">&amp;</span>str = <span class="string">&quot;./spacetraders.save&quot;</span>;

        <span class="kw">let </span><span class="kw-2">mut </span>save_data = BufReader::new(File::open(SAVEFILE)<span class="question-mark">?</span>).lines();

        <span class="comment">// Read first line and get token
        </span><span class="kw">let </span>token = save_data
            .next()
            .ok_or_else(|| SpaceTradersError::InvalidSave(SAVEFILE.into()))<span class="question-mark">??</span>;

        <span class="comment">// Read second line and get cache
        </span><span class="kw">let </span>cache: CachedInfo = serde_json::from_str(
            <span class="kw-2">&amp;</span>save_data
                .next()
                .ok_or_else(|| SpaceTradersError::InvalidSave(SAVEFILE.into()))<span class="question-mark">??</span>,
        )<span class="question-mark">?</span>;

        <span class="prelude-val">Ok</span>(<span class="self">Self </span>{
            client: reqwest::Client::new(),
            token: <span class="prelude-val">Some</span>(token),
            token_set: <span class="bool-val">true</span>,
            cache: <span class="prelude-val">Some</span>(cache),
        })
    }

    <span class="comment">// TODO: Eventually add support for multiple save files
    //
    </span><span class="doccomment">/// Saves the `SpaceTradersClient` to a file named `spacetraders.save`.
    ///
    /// This data can be retrieved using [load_saved](SpaceTradersClient::load_saved).
    </span><span class="kw">pub fn </span>save_client(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; STResult&lt;()&gt; {
        <span class="kw">use </span>std::fs::File;
        <span class="kw">use </span>std::io::Write;

        <span class="kw">const </span>SAVEFILE: <span class="kw-2">&amp;</span>str = <span class="string">&quot;./spacetraders.save&quot;</span>;

        <span class="kw">if </span>!<span class="self">self</span>.token_set || <span class="self">self</span>.token.is_none() {
            <span class="kw">return </span><span class="prelude-val">Err</span>(SpaceTradersError::TokenNotSet);
        }

        <span class="comment">// Save cached data
        </span><span class="kw">if </span><span class="self">self</span>.cache.is_some() {
            <span class="kw">let </span>token = <span class="self">self</span>.token.as_ref().unwrap();
            <span class="kw">let </span><span class="kw-2">mut </span>cached_data = File::create(SAVEFILE)<span class="question-mark">?</span>;
            <span class="kw">let </span>file_contents = <span class="macro">format!</span>(
                <span class="string">&quot;{}\n{}&quot;</span>,
                token,
                serde_json::to_string(<span class="self">self</span>.cache.as_ref().unwrap())<span class="question-mark">?
            </span>);
            cached_data.write_all(file_contents.as_bytes())<span class="question-mark">?</span>;
        } <span class="kw">else </span>{
            <span class="kw">return </span><span class="prelude-val">Err</span>(SpaceTradersError::EmptyCache);
        }

        <span class="prelude-val">Ok</span>(())
    }

    <span class="doccomment">/// Registers the given (unique) callsign with the Space Traders API.
    ///
    /// The response from the API is used to populate the fields of the [SpaceTradersClient].
    ///
    /// # Example
    /// ```
    /// # use space_traders::prelude::*;
    /// # tokio_test::block_on(async {
    /// // Creates SpaceTradersClient with the `client` field initalized.
    /// let mut client = SpaceTradersClient::default();
    ///
    /// // Populates the `cache` field with values from the response.
    /// // Note: callsign must be unique or an error is returned!
    /// client.register_callsign(&quot;UNIQUE_SYMBOL&quot;, None).await.unwrap_err();
    /// # })
    /// ```
    </span><span class="kw">pub async fn </span>register_callsign(
        <span class="kw-2">&amp;mut </span><span class="self">self</span>,
        callsign: <span class="kw-2">&amp;</span>str,
        faction: <span class="prelude-ty">Option</span>&lt;FactionSymbol&gt;,
    ) -&gt; STResult&lt;()&gt; {
        <span class="kw">use </span>reqwest::header::{HeaderName, CONTENT_TYPE};

        <span class="kw">let </span>clen = callsign.len();
        <span class="kw">if </span>!(<span class="number">3</span>..=<span class="number">14</span>).contains(<span class="kw-2">&amp;</span>clen) {
            <span class="kw">return </span><span class="prelude-val">Err</span>(SpaceTradersError::InvalidCallsignLength);
        }

        <span class="kw">const </span>URL: <span class="kw-2">&amp;</span>str = <span class="string">&quot;https://api.spacetraders.io/v2/register&quot;</span>;
        <span class="kw">const </span>HEADER: (HeaderName, <span class="kw-2">&amp;</span>str) = (CONTENT_TYPE, <span class="string">&quot;application/json&quot;</span>);

        <span class="kw">let </span><span class="kw-2">mut </span>data = HashMap::with_capacity(<span class="number">1</span>);
        data.insert(<span class="string">&quot;symbol&quot;</span>, callsign);
        <span class="kw">if let </span><span class="prelude-val">Some</span>(faction) = faction {
            data.insert(<span class="string">&quot;faction&quot;</span>, faction.as_str());
        } <span class="kw">else </span>{
            data.insert(<span class="string">&quot;faction&quot;</span>, <span class="string">&quot;COSMIC&quot;</span>);
        }

        <span class="comment">// Send request
        </span><span class="kw">let </span>res = <span class="self">self
            </span>.client
            .post(URL)
            .header(HEADER.<span class="number">0</span>, HEADER.<span class="number">1</span>)
            .json(<span class="kw-2">&amp;</span>data)
            .send()
            .<span class="kw">await</span><span class="question-mark">?</span>;

        <span class="attribute">#[derive(serde::Deserialize, Debug)]
        #[serde(rename_all = <span class="string">&quot;camelCase&quot;</span>)]
        </span><span class="kw">pub struct </span>RegistrationResponse {
            token: String,
            agent: Agent,
            contract: Contract,
            faction: Faction,
            ship: Ship,
        }

        <span class="kw">match </span>res.json::&lt;ResponseData&lt;RegistrationResponse&gt;&gt;().<span class="kw">await</span><span class="question-mark">? </span>{
            ResponseData::Data(registered_info) =&gt; {
                <span class="self">self</span>.token = <span class="prelude-val">Some</span>(registered_info.token);
                <span class="self">self</span>.token_set = <span class="bool-val">true</span>;

                <span class="self">self</span>.cache = <span class="prelude-val">Some</span>(CachedInfo {
                    agent: registered_info.agent,
                    contracts: <span class="macro">vec!</span>[registered_info.contract],
                    faction: registered_info.faction,
                    ship: registered_info.ship,
                });

                <span class="prelude-val">Ok</span>(())
            }
            ResponseData::Error(err) =&gt; <span class="prelude-val">Err</span>(SpaceTradersError::SpaceTradersResponseError(err)),
        }
    }

    <span class="doccomment">/// Get a reference to the [Agent] associated with the current client.
    </span><span class="kw">pub fn </span>agent(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; STResult&lt;<span class="kw-2">&amp;</span>Agent&gt; {
        <span class="kw">if let </span><span class="prelude-val">Some</span>(cache) = <span class="kw-2">&amp;</span><span class="self">self</span>.cache {
            <span class="kw">return </span><span class="prelude-val">Ok</span>(<span class="kw-2">&amp;</span>cache.agent);
        }

        <span class="prelude-val">Err</span>(SpaceTradersError::EmptyCache)
    }

    <span class="doccomment">/// Get a mutable reference to the [Agent] associated with the current client.
    </span><span class="kw">pub fn </span>agent_mut(<span class="kw-2">&amp;mut </span><span class="self">self</span>) -&gt; STResult&lt;<span class="kw-2">&amp;mut </span>Agent&gt; {
        <span class="kw">if let </span><span class="prelude-val">Some</span>(cache) = <span class="kw-2">&amp;mut </span><span class="self">self</span>.cache {
            <span class="kw">return </span><span class="prelude-val">Ok</span>(<span class="kw-2">&amp;mut </span>cache.agent);
        }

        <span class="prelude-val">Err</span>(SpaceTradersError::EmptyCache)
    }

    <span class="kw">pub async fn </span>view_waypoint(
        <span class="kw-2">&amp;</span><span class="self">self</span>,
        system_symbol: Symbol,
        waypoint_symbol: Symbol,
    ) -&gt; STResult&lt;Waypoint&gt; {
        <span class="kw">use </span>reqwest::header::AUTHORIZATION;

        <span class="kw">if </span>!<span class="self">self</span>.token_set || <span class="self">self</span>.token.is_none() {
            <span class="kw">return </span><span class="prelude-val">Err</span>(SpaceTradersError::TokenNotSet);
        }

        <span class="kw">let </span>url = <span class="macro">format!</span>(
            <span class="string">&quot;https://api.spacetraders.io/v2/systems/{}/waypoints/{}&quot;</span>,
            <span class="kw-2">*</span>system_symbol, <span class="kw-2">*</span>waypoint_symbol
        );

        <span class="kw">let </span>header = (AUTHORIZATION, <span class="self">self</span>.token.as_ref().unwrap());

        <span class="comment">// Send request
        </span><span class="kw">let </span>res = <span class="self">self
            </span>.client
            .get(url)
            .header(header.<span class="number">0</span>, header.<span class="number">1</span>)
            .send()
            .<span class="kw">await</span><span class="question-mark">?</span>;

        <span class="kw">match </span>res.json::&lt;ResponseData&lt;Waypoint&gt;&gt;().<span class="kw">await</span><span class="question-mark">? </span>{
            ResponseData::Data(waypoint) =&gt; <span class="prelude-val">Ok</span>(waypoint),
            ResponseData::Error(err) =&gt; <span class="prelude-val">Err</span>(SpaceTradersError::SpaceTradersResponseError(err)),
        }
    }
}

<span class="attribute">#[cfg(test)]
</span><span class="kw">mod </span>tests {
    <span class="kw">use </span>std::str::FromStr;

    <span class="kw">use crate</span>::{
        contract::ContractType,
        faction::FactionTraitSymbol,
        ship::{
            Deposit, EngineSymbol, FlightMode, FrameSymbol, ModuleSymbol, MountSymbol,
            ReactorSymbol, Role, Rotation, ShipStatus,
        },
        waypoint::{WaypointTraitSymbols, WaypointType},
    };

    <span class="kw">use super</span>::<span class="kw-2">*</span>;

    <span class="kw">fn </span>gen_callsign() -&gt; String {
        <span class="kw">use </span>std::time::Instant;

        <span class="kw">let </span>t1 = Instant::now();
        <span class="kw">let </span>t2 = Instant::now();

        <span class="macro">format!</span>(
            <span class="string">&quot;{}TEST{}&quot;</span>,
            t1.elapsed().subsec_nanos(),
            t2.elapsed().subsec_nanos()
        )
    }

    <span class="kw">fn </span>check_default_values(cache: CachedInfo, callsign: <span class="kw-2">&amp;</span>str) {
        <span class="kw">let </span>agent = cache.agent;
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>agent.symbol, callsign);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>agent.headquarters, <span class="string">&quot;X1-DF55-20250Z&quot;</span>);
        <span class="macro">assert_eq!</span>(agent.credits, <span class="number">100_000</span>);

        <span class="kw">let </span>contracts = cache.contracts;
        <span class="macro">assert_eq!</span>(contracts.len(), <span class="number">1</span>);
        <span class="macro">assert_eq!</span>(contracts[<span class="number">0</span>].faction_symbol, FactionSymbol::Cosmic);
        <span class="macro">assert_eq!</span>(contracts[<span class="number">0</span>].contract_type, ContractType::Procurement);
        <span class="macro">assert_eq!</span>(contracts[<span class="number">0</span>].terms.deliver[<span class="number">0</span>].units_fulfilled, <span class="number">0</span>);
        <span class="macro">assert!</span>(!contracts[<span class="number">0</span>].accepted);
        <span class="macro">assert!</span>(!contracts[<span class="number">0</span>].fulfilled);

        <span class="kw">let </span>faction = cache.faction;
        <span class="macro">assert_eq!</span>(faction.symbol, FactionSymbol::Cosmic);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>faction.name, <span class="string">&quot;Cosmic Engineers&quot;</span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>faction.description, <span class="string">&quot;The Cosmic Engineers are a group of highly advanced scientists and engineers who seek to terraform and colonize new worlds, pushing the boundaries of technology and exploration.&quot;</span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>faction.headquarters, <span class="string">&quot;X1-DF55-20250Z&quot;</span>);
        <span class="macro">assert_eq!</span>(faction.traits.len(), <span class="number">4</span>);

        <span class="kw">let </span>traits = faction.traits;
        <span class="macro">assert_eq!</span>(traits[<span class="number">0</span>].symbol, FactionTraitSymbol::Innovative);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>traits[<span class="number">0</span>].name, <span class="string">&quot;Innovative&quot;</span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>traits[<span class="number">0</span>].description, <span class="string">&quot;Willing to try new and untested ideas. Sometimes able to come up with creative and original solutions to problems, and may be able to think outside the box. Sometimes at the forefront of technological or social change, and may be willing to take risks in order to advance the boundaries of human knowledge and understanding.&quot;</span>);
        <span class="macro">assert_eq!</span>(traits[<span class="number">1</span>].symbol, FactionTraitSymbol::Bold);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>traits[<span class="number">1</span>].name, <span class="string">&quot;Bold&quot;</span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>traits[<span class="number">1</span>].description, <span class="string">&quot;Unafraid to take risks and challenge the status quo. Sometimes willing to do things that others would not dare, and may be able to overcome obstacles and challenges that would be insurmountable for others. Sometimes able to inspire and motivate others to take bold action as well.&quot;</span>);
        <span class="macro">assert_eq!</span>(traits[<span class="number">2</span>].symbol, FactionTraitSymbol::Visionary);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>traits[<span class="number">2</span>].name, <span class="string">&quot;Visionary&quot;</span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>traits[<span class="number">2</span>].description, <span class="string">&quot;Possessing a clear and compelling vision for the future. Sometimes able to see beyond the present and anticipate the needs and challenges of tomorrow. Sometimes able to inspire and guide others towards a better and brighter future, and may be willing to take bold and decisive action to make their vision a reality.&quot;</span>);
        <span class="macro">assert_eq!</span>(traits[<span class="number">3</span>].symbol, FactionTraitSymbol::Curious);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>traits[<span class="number">3</span>].name, <span class="string">&quot;Curious&quot;</span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>traits[<span class="number">3</span>].description, <span class="string">&quot;Possessing a strong desire to learn and explore. Sometimes interested in a wide range of topics and may be willing to take risks in order to satisfy their curiosity. Sometimes able to think outside the box and come up with creative solutions to challenges.&quot;</span>);

        <span class="kw">let </span>ship = cache.ship;
        <span class="kw">let </span>nav = <span class="kw-2">&amp;</span>ship.nav;
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>nav.system_symbol, <span class="string">&quot;X1-DF55&quot;</span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>nav.waypoint_symbol, <span class="string">&quot;X1-DF55-20250Z&quot;</span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>nav.route.departure.symbol, <span class="string">&quot;X1-DF55-20250Z&quot;</span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>nav.route.departure.system_symbol, <span class="string">&quot;X1-DF55&quot;</span>);
        <span class="macro">assert_eq!</span>(nav.route.departure.x, -<span class="number">5</span>);
        <span class="macro">assert_eq!</span>(nav.route.departure.y, <span class="number">9</span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>nav.route.destination.symbol, <span class="string">&quot;X1-DF55-20250Z&quot;</span>);
        <span class="macro">assert_eq!</span>(nav.route.destination.waypoint_type, WaypointType::Planet);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>ship.nav.route.destination.system_symbol, <span class="string">&quot;X1-DF55&quot;</span>);
        <span class="macro">assert_eq!</span>(ship.nav.route.destination.x, -<span class="number">5</span>);
        <span class="macro">assert_eq!</span>(ship.nav.route.destination.y, <span class="number">9</span>);
        <span class="macro">assert_eq!</span>(ship.nav.status, ShipStatus::Docked);
        <span class="macro">assert_eq!</span>(ship.nav.flight_mode, FlightMode::Cruise);

        <span class="kw">let </span>crew = ship.crew;
        <span class="macro">assert_eq!</span>(crew.current, <span class="number">0</span>);
        <span class="macro">assert_eq!</span>(crew.capacity, <span class="number">80</span>);
        <span class="macro">assert_eq!</span>(crew.required, <span class="number">59</span>);
        <span class="macro">assert_eq!</span>(crew.rotation, Rotation::Strict);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>crew.morale, <span class="number">100</span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>crew.wages, <span class="number">0</span>);

        <span class="kw">let </span>fuel = ship.fuel;
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>fuel.current, <span class="number">1200</span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>fuel.capacity, <span class="number">1200</span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>fuel.consumed.amount, <span class="number">0</span>);

        <span class="kw">let </span>frame = ship.frame;
        <span class="macro">assert_eq!</span>(frame.symbol, FrameSymbol::FrameFrigate);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>frame.name, <span class="string">&quot;Frame Frigate&quot;</span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>frame.description, <span class="string">&quot;A medium-sized, multi-purpose spacecraft, often used for combat, transport, or support operations.&quot;</span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>frame.module_slots, <span class="number">8</span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>frame.mounting_points, <span class="number">5</span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>frame.fuel_capacity, <span class="number">1200</span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>frame.condition, <span class="number">100</span>);
        <span class="macro">assert_eq!</span>(frame.requirements.power, <span class="prelude-val">Some</span>(<span class="number">8</span>));
        <span class="macro">assert_eq!</span>(frame.requirements.crew, <span class="prelude-val">Some</span>(<span class="number">25</span>));

        <span class="kw">let </span>reactor = ship.reactor;
        <span class="macro">assert_eq!</span>(reactor.symbol, ReactorSymbol::ReactorFissionI);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>reactor.name, <span class="string">&quot;Fission Reactor I&quot;</span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>reactor.description, <span class="string">&quot;A basic fission power reactor, used to generate electricity from nuclear fission reactions.&quot;</span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>reactor.condition, <span class="number">100</span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>reactor.power_output, <span class="number">31</span>);
        <span class="macro">assert_eq!</span>(reactor.requirements.crew, <span class="prelude-val">Some</span>(<span class="number">8</span>));

        <span class="kw">let </span>engine = ship.engine;
        <span class="macro">assert_eq!</span>(engine.symbol, EngineSymbol::EngineIonDriveII);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>engine.name, <span class="string">&quot;Ion Drive II&quot;</span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>engine.description, <span class="string">&quot;An advanced propulsion system that uses ionized particles to generate high-speed, low-thrust acceleration, with improved efficiency and performance.&quot;</span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>engine.condition, <span class="number">100</span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>engine.speed, <span class="number">30</span>);
        <span class="macro">assert_eq!</span>(engine.requirements.power, <span class="prelude-val">Some</span>(<span class="number">6</span>));
        <span class="macro">assert_eq!</span>(engine.requirements.crew, <span class="prelude-val">Some</span>(<span class="number">8</span>));

        <span class="kw">let </span>modules = ship.modules;
        <span class="macro">assert_eq!</span>(modules.len(), <span class="number">7</span>);
        <span class="macro">assert_eq!</span>(modules[<span class="number">0</span>].symbol, ModuleSymbol::ModuleCargoHoldI);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>modules[<span class="number">0</span>].name, <span class="string">&quot;Cargo Hold&quot;</span>);
        <span class="macro">assert_eq!</span>(
            <span class="kw-2">*</span>modules[<span class="number">0</span>].description,
            <span class="string">&quot;A module that increases a ship&#39;s cargo capacity.&quot;
        </span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">**</span>modules[<span class="number">0</span>].capacity.as_ref().unwrap(), <span class="number">30</span>);
        <span class="macro">assert_eq!</span>(modules[<span class="number">0</span>].requirements.crew, <span class="prelude-val">Some</span>(<span class="number">0</span>));
        <span class="macro">assert_eq!</span>(modules[<span class="number">0</span>].requirements.power, <span class="prelude-val">Some</span>(<span class="number">1</span>));
        <span class="macro">assert_eq!</span>(modules[<span class="number">0</span>].requirements.slots, <span class="prelude-val">Some</span>(<span class="number">1</span>));
        <span class="macro">assert_eq!</span>(modules[<span class="number">1</span>].symbol, ModuleSymbol::ModuleCargoHoldI);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>modules[<span class="number">1</span>].name, <span class="string">&quot;Cargo Hold&quot;</span>);
        <span class="macro">assert_eq!</span>(
            <span class="kw-2">*</span>modules[<span class="number">1</span>].description,
            <span class="string">&quot;A module that increases a ship&#39;s cargo capacity.&quot;
        </span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">**</span>modules[<span class="number">1</span>].capacity.as_ref().unwrap(), <span class="number">30</span>);
        <span class="macro">assert_eq!</span>(modules[<span class="number">1</span>].requirements.crew, <span class="prelude-val">Some</span>(<span class="number">0</span>));
        <span class="macro">assert_eq!</span>(modules[<span class="number">1</span>].requirements.power, <span class="prelude-val">Some</span>(<span class="number">1</span>));
        <span class="macro">assert_eq!</span>(modules[<span class="number">1</span>].requirements.slots, <span class="prelude-val">Some</span>(<span class="number">1</span>));
        <span class="macro">assert_eq!</span>(modules[<span class="number">2</span>].symbol, ModuleSymbol::ModuleCrewQuartersI);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>modules[<span class="number">2</span>].name, <span class="string">&quot;Crew Quarters&quot;</span>);
        <span class="macro">assert_eq!</span>(
            <span class="kw-2">*</span>modules[<span class="number">2</span>].description,
            <span class="string">&quot;A module that provides living space and amenities for the crew.&quot;
        </span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">**</span>modules[<span class="number">2</span>].capacity.as_ref().unwrap(), <span class="number">40</span>);
        <span class="macro">assert_eq!</span>(modules[<span class="number">2</span>].requirements.crew, <span class="prelude-val">Some</span>(<span class="number">2</span>));
        <span class="macro">assert_eq!</span>(modules[<span class="number">2</span>].requirements.power, <span class="prelude-val">Some</span>(<span class="number">1</span>));
        <span class="macro">assert_eq!</span>(modules[<span class="number">2</span>].requirements.slots, <span class="prelude-val">Some</span>(<span class="number">1</span>));
        <span class="macro">assert_eq!</span>(modules[<span class="number">3</span>].symbol, ModuleSymbol::ModuleCrewQuartersI);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>modules[<span class="number">3</span>].name, <span class="string">&quot;Crew Quarters&quot;</span>);
        <span class="macro">assert_eq!</span>(
            <span class="kw-2">*</span>modules[<span class="number">3</span>].description,
            <span class="string">&quot;A module that provides living space and amenities for the crew.&quot;
        </span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">**</span>modules[<span class="number">3</span>].capacity.as_ref().unwrap(), <span class="number">40</span>);
        <span class="macro">assert_eq!</span>(modules[<span class="number">3</span>].requirements.crew, <span class="prelude-val">Some</span>(<span class="number">2</span>));
        <span class="macro">assert_eq!</span>(modules[<span class="number">3</span>].requirements.power, <span class="prelude-val">Some</span>(<span class="number">1</span>));
        <span class="macro">assert_eq!</span>(modules[<span class="number">3</span>].requirements.slots, <span class="prelude-val">Some</span>(<span class="number">1</span>));
        <span class="macro">assert_eq!</span>(modules[<span class="number">4</span>].symbol, ModuleSymbol::ModuleMineralProcessorI);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>modules[<span class="number">4</span>].name, <span class="string">&quot;Mineral Processor&quot;</span>);
        <span class="macro">assert_eq!</span>(
            <span class="kw-2">*</span>modules[<span class="number">4</span>].description,
            <span class="string">&quot;Crushes and processes extracted minerals and ores into their component parts, filters out impurities, and containerizes them into raw storage units.&quot;
        </span>);
        <span class="macro">assert_eq!</span>(modules[<span class="number">4</span>].requirements.crew, <span class="prelude-val">Some</span>(<span class="number">0</span>));
        <span class="macro">assert_eq!</span>(modules[<span class="number">4</span>].requirements.power, <span class="prelude-val">Some</span>(<span class="number">1</span>));
        <span class="macro">assert_eq!</span>(modules[<span class="number">4</span>].requirements.slots, <span class="prelude-val">Some</span>(<span class="number">2</span>));
        <span class="macro">assert_eq!</span>(modules[<span class="number">5</span>].symbol, ModuleSymbol::ModuleJumpDriveI);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>modules[<span class="number">5</span>].name, <span class="string">&quot;Jump Drive I&quot;</span>);
        <span class="macro">assert_eq!</span>(
            <span class="kw-2">*</span>modules[<span class="number">5</span>].description,
            <span class="string">&quot;A basic antimatter jump drive that allows for instantaneous short-range interdimensional travel.&quot;
        </span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">**</span>modules[<span class="number">5</span>].range.as_ref().unwrap(), <span class="number">500</span>);
        <span class="macro">assert_eq!</span>(modules[<span class="number">5</span>].requirements.crew, <span class="prelude-val">Some</span>(<span class="number">10</span>));
        <span class="macro">assert_eq!</span>(modules[<span class="number">5</span>].requirements.power, <span class="prelude-val">Some</span>(<span class="number">4</span>));
        <span class="macro">assert_eq!</span>(modules[<span class="number">5</span>].requirements.slots, <span class="prelude-val">Some</span>(<span class="number">1</span>));
        <span class="macro">assert_eq!</span>(modules[<span class="number">6</span>].symbol, ModuleSymbol::ModuleWarpDriveI);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>modules[<span class="number">6</span>].name, <span class="string">&quot;Warp Drive I&quot;</span>);
        <span class="macro">assert_eq!</span>(
            <span class="kw-2">*</span>modules[<span class="number">6</span>].description,
            <span class="string">&quot;A basic warp drive that allows for short-range interstellar travel.&quot;
        </span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">**</span>modules[<span class="number">6</span>].range.as_ref().unwrap(), <span class="number">2000</span>);
        <span class="macro">assert_eq!</span>(modules[<span class="number">6</span>].requirements.crew, <span class="prelude-val">Some</span>(<span class="number">2</span>));
        <span class="macro">assert_eq!</span>(modules[<span class="number">6</span>].requirements.power, <span class="prelude-val">Some</span>(<span class="number">3</span>));
        <span class="macro">assert_eq!</span>(modules[<span class="number">6</span>].requirements.slots, <span class="prelude-val">Some</span>(<span class="number">1</span>));

        <span class="kw">let </span>mounts = ship.mounts;
        <span class="macro">assert_eq!</span>(mounts.len(), <span class="number">3</span>);
        <span class="macro">assert_eq!</span>(mounts[<span class="number">0</span>].symbol, MountSymbol::MountSensorArrayI);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>mounts[<span class="number">0</span>].name, <span class="string">&quot;Sensor Array I&quot;</span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>mounts[<span class="number">0</span>].description, <span class="string">&quot;A basic sensor array that improves a ship&#39;s ability to detect and track other objects in space.&quot;</span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>mounts[<span class="number">0</span>].strength, <span class="number">1</span>);
        <span class="macro">assert_eq!</span>(mounts[<span class="number">0</span>].requirements.crew, <span class="prelude-val">Some</span>(<span class="number">0</span>));
        <span class="macro">assert_eq!</span>(mounts[<span class="number">0</span>].requirements.power, <span class="prelude-val">Some</span>(<span class="number">1</span>));
        <span class="macro">assert_eq!</span>(mounts[<span class="number">1</span>].symbol, MountSymbol::MountMiningLaserI);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>mounts[<span class="number">1</span>].name, <span class="string">&quot;Mining Laser I&quot;</span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>mounts[<span class="number">1</span>].description, <span class="string">&quot;A basic mining laser that can be used to extract valuable minerals from asteroids and other space objects.&quot;</span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>mounts[<span class="number">1</span>].strength, <span class="number">10</span>);
        <span class="macro">assert_eq!</span>(mounts[<span class="number">1</span>].requirements.crew, <span class="prelude-val">Some</span>(<span class="number">0</span>));
        <span class="macro">assert_eq!</span>(mounts[<span class="number">1</span>].requirements.power, <span class="prelude-val">Some</span>(<span class="number">1</span>));
        <span class="macro">assert_eq!</span>(mounts[<span class="number">2</span>].symbol, MountSymbol::MountSurveyorI);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>mounts[<span class="number">2</span>].name, <span class="string">&quot;Surveyor I&quot;</span>);
        <span class="macro">assert_eq!</span>(
            <span class="kw-2">*</span>mounts[<span class="number">2</span>].description,
            <span class="string">&quot;A basic survey probe that can be used to gather information about a mineral deposit.&quot;
        </span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>mounts[<span class="number">2</span>].strength, <span class="number">1</span>);
        <span class="macro">assert_eq!</span>(mounts[<span class="number">2</span>].requirements.crew, <span class="prelude-val">Some</span>(<span class="number">2</span>));
        <span class="macro">assert_eq!</span>(mounts[<span class="number">2</span>].requirements.power, <span class="prelude-val">Some</span>(<span class="number">1</span>));
        <span class="kw">let </span>deposits = mounts[<span class="number">2</span>].deposits.as_ref().unwrap();
        <span class="macro">assert_eq!</span>(deposits.len(), <span class="number">11</span>);
        <span class="macro">assert_eq!</span>(
            <span class="kw-2">*</span>deposits,
            <span class="macro">vec!</span>[
                Deposit::QuartzSand,
                Deposit::SiliconCrystals,
                Deposit::PreciousStones,
                Deposit::IceWater,
                Deposit::AmmoniaIce,
                Deposit::IronOre,
                Deposit::CopperOre,
                Deposit::SilverOre,
                Deposit::AluminumOre,
                Deposit::GoldOre,
                Deposit::PlatinumOre,
            ]
        );

        <span class="kw">let </span>registration = ship.registration;
        <span class="macro">assert_eq!</span>(registration.faction_symbol, FactionSymbol::Cosmic);
        <span class="macro">assert_eq!</span>(registration.role, Role::Command);

        <span class="kw">let </span>cargo = ship.cargo;
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>cargo.capacity, <span class="number">60</span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>cargo.units, <span class="number">15</span>);
        <span class="macro">assert_eq!</span>(cargo.inventory.len(), <span class="number">1</span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>cargo.inventory[<span class="number">0</span>].symbol, <span class="string">&quot;ANTIMATTER&quot;</span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>cargo.inventory[<span class="number">0</span>].name, <span class="string">&quot;Antimatter&quot;</span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>cargo.inventory[<span class="number">0</span>].description, <span class="string">&quot;A highly valuable and dangerous substance used for advanced propulsion and weapons systems.&quot;</span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>cargo.inventory[<span class="number">0</span>].units, <span class="number">15</span>);
    }

    <span class="attribute">#[tokio::test]
    </span><span class="kw">async fn </span>can_register_agent() {
        <span class="kw">use </span>std::{thread, time::Duration};

        <span class="comment">// Sleep so gen_callsign() generates a different callsign from other tests
        </span>thread::sleep(Duration::from_millis(<span class="number">10</span>));

        <span class="kw">let </span>callsign = gen_callsign();

        <span class="kw">let </span><span class="kw-2">mut </span>client = SpaceTradersClient::default();
        client.register_callsign(<span class="kw-2">&amp;</span>callsign, <span class="prelude-val">None</span>).<span class="kw">await</span>.unwrap();

        <span class="macro">assert!</span>(client.token_set);
        <span class="kw">let </span>cache = client.cache.unwrap();
        check_default_values(cache, <span class="kw-2">&amp;</span>callsign);
    }

    <span class="attribute">#[tokio::test]
    </span><span class="kw">async fn </span>can_save_and_load_client() {
        <span class="kw">use </span>std::{thread, time::Duration};

        <span class="comment">// Sleep so gen_callsign() generates a different callsign from other tests
        </span>thread::sleep(Duration::from_millis(<span class="number">5</span>));

        <span class="kw">let </span>callsign = gen_callsign();

        <span class="kw">let </span><span class="kw-2">mut </span>client = SpaceTradersClient::default();
        client.register_callsign(<span class="kw-2">&amp;</span>callsign, <span class="prelude-val">None</span>).<span class="kw">await</span>.unwrap();

        client.save_client().unwrap();

        <span class="kw">let </span>saved_client = SpaceTradersClient::load_saved().unwrap();

        <span class="macro">assert_eq!</span>(saved_client.token, client.token);

        <span class="comment">// TODO: Check all cached values!
        </span><span class="kw">let </span>cache = client.cache.unwrap();
        <span class="kw">let </span>saved_cache = saved_client.cache.unwrap();
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>saved_cache.ship.symbol, <span class="kw-2">*</span>cache.ship.symbol);
        check_default_values(saved_cache, <span class="kw-2">&amp;</span>callsign);
    }

    <span class="attribute">#[tokio::test]
    </span><span class="kw">async fn </span>can_query_waypoint() {
        <span class="kw">let </span>client = SpaceTradersClient::load_saved().unwrap();

        <span class="kw">let </span>waypoint = client
            .view_waypoint(
                <span class="string">&quot;X1-DF55&quot;</span>.try_into().unwrap(),
                <span class="string">&quot;X1-DF55-20250Z&quot;</span>.try_into().unwrap(),
            )
            .<span class="kw">await
            </span>.unwrap();

        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>waypoint.system_symbol, <span class="string">&quot;X1-DF55&quot;</span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>waypoint.symbol, <span class="string">&quot;X1-DF55-20250Z&quot;</span>);
        <span class="macro">assert_eq!</span>(waypoint.waypoint_type, WaypointType::Planet);
        <span class="macro">assert_eq!</span>(waypoint.x, -<span class="number">5</span>);
        <span class="macro">assert_eq!</span>(waypoint.y, <span class="number">9</span>);

        <span class="kw">let </span>orbitals = waypoint.orbitals;
        <span class="macro">assert_eq!</span>(orbitals.len(), <span class="number">3</span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>orbitals[<span class="number">0</span>].symbol, <span class="string">&quot;X1-DF55-89861D&quot;</span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>orbitals[<span class="number">1</span>].symbol, <span class="string">&quot;X1-DF55-64862A&quot;</span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>orbitals[<span class="number">2</span>].symbol, <span class="string">&quot;X1-DF55-71593D&quot;</span>);

        <span class="kw">let </span>traits = waypoint.traits;
        <span class="macro">assert_eq!</span>(traits.len(), <span class="number">5</span>);
        <span class="macro">assert_eq!</span>(traits[<span class="number">0</span>].symbol, WaypointTraitSymbols::Overcrowded);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>traits[<span class="number">0</span>].name, <span class="string">&quot;Overcrowded&quot;</span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>traits[<span class="number">0</span>].description, <span class="string">&quot;A waypoint teeming with inhabitants, leading to cramped living conditions and a high demand for resources.&quot;</span>);
        <span class="macro">assert_eq!</span>(traits[<span class="number">1</span>].symbol, WaypointTraitSymbols::HighTech);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>traits[<span class="number">1</span>].name, <span class="string">&quot;High-Tech&quot;</span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>traits[<span class="number">1</span>].description, <span class="string">&quot;A center of innovation and cutting-edge technology, driving progress and attracting skilled individuals from around the galaxy.&quot;</span>);
        <span class="macro">assert_eq!</span>(traits[<span class="number">2</span>].symbol, WaypointTraitSymbols::Bureaucratic);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>traits[<span class="number">2</span>].name, <span class="string">&quot;Bureaucratic&quot;</span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>traits[<span class="number">2</span>].description, <span class="string">&quot;A waypoint governed by complex regulations, red tape, and layers of administration, often leading to inefficiencies and frustration.&quot;</span>);
        <span class="macro">assert_eq!</span>(traits[<span class="number">3</span>].symbol, WaypointTraitSymbols::Temperate);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>traits[<span class="number">3</span>].name, <span class="string">&quot;Temperate&quot;</span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>traits[<span class="number">3</span>].description, <span class="string">&quot;A world with a mild climate and balanced ecosystem, providing a comfortable environment for a variety of life forms and supporting diverse industries.&quot;</span>);
        <span class="macro">assert_eq!</span>(traits[<span class="number">4</span>].symbol, WaypointTraitSymbols::Marketplace);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>traits[<span class="number">4</span>].name, <span class="string">&quot;Marketplace&quot;</span>);
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>traits[<span class="number">4</span>].description, <span class="string">&quot;A thriving center of commerce where traders from across the galaxy gather to buy, sell, and exchange goods.&quot;</span>);

        <span class="kw">let </span>chart = waypoint.chart.unwrap();
        <span class="macro">assert_eq!</span>(<span class="kw-2">*</span>chart.submitted_by.unwrap(), <span class="string">&quot;COSMIC&quot;</span>);
        <span class="kw">let </span>submitted_on: chrono::DateTime&lt;chrono::Utc&gt; =
            chrono::DateTime::from_str(<span class="string">&quot;2023-01-23T17:20:36.870Z&quot;</span>).unwrap();
        <span class="macro">assert_eq!</span>(chart.submitted_on, submitted_on);

        <span class="macro">assert_eq!</span>(waypoint.faction.unwrap().symbol, FactionSymbol::Cosmic);
    }
}
</code></pre></div>
</section></div></main><div id="rustdoc-vars" data-root-path="../../" data-current-crate="space_traders" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.65.0 (897e37553 2022-11-02)" ></div></body></html>